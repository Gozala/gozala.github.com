---
layout: post
title: Git info in prompt
tags: bash git
---

There are a lot of blog posts describing techniques of putting your current git
branch in your bash prompt. After reading one of those posts more then year ago
I immediately edited my `~/.bash_profile` and was very happy until very recent,
when I have started using `--color` argument with git commands. Surprisingly to
me colors made me so much more effective that I quickly tweaked my git config:
`git config --global color.ui auto` This allowed my to have colors everywhere by
default. Shortly after I got an idea that colors in prompt may be used for
displaying a status of the working tree / index.

**Motivation**

I really wanted to try that idea out, because I thought it was a chance to solve
a problem that bugged me for years already. I was looking for a way to remind
myself to commit more often, since I tempt to commit only after I'm done with a
task and it's hard to imagine how many times I regretted that!!

**Design**

So my plan was to display "current git branch" in a bash prompt in a different
color depending on a state of the working tree / index:

<ul>
  <li style='color:#8998DD'>No changes</li>
  <li style='color:#6EA4D0'>Untracked files</li>
  <li style='color:#74A77C'>Stashed changes</li>
  <li style='color:#53ADA0'>Modified files</li>
  <li style='color:#DA7865'>Deleted files</li>
</ul>

**Implementation**

I wont bother you with a details on how to get a "current git branch" since
there are lots of posts about it, instead I'll focus your attention on snippet
that parses git status and adds colors:

<script src="http://gist.github.com/564751.js">
<pre><div class="line" id="LC1"><span class="nv">txtblk</span><span class="o">=</span><span class="s1">'\033[0;30m'</span> <span class="c"># Black - Regular</span></div><div class="line" id="LC2"><span class="nv">txtred</span><span class="o">=</span><span class="s1">'\033[0;31m'</span> <span class="c"># Red</span></div><div class="line" id="LC3"><span class="nv">txtgrn</span><span class="o">=</span><span class="s1">'\033[0;32m'</span> <span class="c"># Green</span></div><div class="line" id="LC4"><span class="nv">txtylw</span><span class="o">=</span><span class="s1">'\033[0;33m'</span> <span class="c"># Yellow</span></div><div class="line" id="LC5"><span class="nv">txtblu</span><span class="o">=</span><span class="s1">'\033[0;34m'</span> <span class="c"># Blue</span></div><div class="line" id="LC6"><span class="nv">txtpur</span><span class="o">=</span><span class="s1">'\033[0;35m'</span> <span class="c"># Purple</span></div><div class="line" id="LC7"><span class="nv">txtcyn</span><span class="o">=</span><span class="s1">'\033[0;36m'</span> <span class="c"># Cyan</span></div><div class="line" id="LC8"><span class="nv">txtwht</span><span class="o">=</span><span class="s1">'\033[0;37m'</span> <span class="c"># White</span></div><div class="line" id="LC9"><span class="nv">bldblk</span><span class="o">=</span><span class="s1">'\033[1;30m'</span> <span class="c"># Black - Bold</span></div><div class="line" id="LC10"><span class="nv">bldred</span><span class="o">=</span><span class="s1">'\033[1;31m'</span> <span class="c"># Red</span></div><div class="line" id="LC11"><span class="nv">bldgrn</span><span class="o">=</span><span class="s1">'\033[1;32m'</span> <span class="c"># Green</span></div><div class="line" id="LC12"><span class="nv">bldylw</span><span class="o">=</span><span class="s1">'\033[1;33m'</span> <span class="c"># Yellow</span></div><div class="line" id="LC13"><span class="nv">bldblu</span><span class="o">=</span><span class="s1">'\033[1;34m'</span> <span class="c"># Blue</span></div><div class="line" id="LC14"><span class="nv">bldpur</span><span class="o">=</span><span class="s1">'\033[1;35m'</span> <span class="c"># Purple</span></div><div class="line" id="LC15"><span class="nv">bldcyn</span><span class="o">=</span><span class="s1">'\033[1;36m'</span> <span class="c"># Cyan</span></div><div class="line" id="LC16"><span class="nv">bldwht</span><span class="o">=</span><span class="s1">'\033[1;37m'</span> <span class="c"># White</span></div><div class="line" id="LC17"><span class="nv">unkblk</span><span class="o">=</span><span class="s1">'\033[4;30m'</span> <span class="c"># Black - Underline</span></div><div class="line" id="LC18"><span class="nv">undred</span><span class="o">=</span><span class="s1">'\033[4;31m'</span> <span class="c"># Red</span></div><div class="line" id="LC19"><span class="nv">undgrn</span><span class="o">=</span><span class="s1">'\033[4;32m'</span> <span class="c"># Green</span></div><div class="line" id="LC20"><span class="nv">undylw</span><span class="o">=</span><span class="s1">'\033[4;33m'</span> <span class="c"># Yellow</span></div><div class="line" id="LC21"><span class="nv">undblu</span><span class="o">=</span><span class="s1">'\033[4;34m'</span> <span class="c"># Blue</span></div><div class="line" id="LC22"><span class="nv">undpur</span><span class="o">=</span><span class="s1">'\033[4;35m'</span> <span class="c"># Purple</span></div><div class="line" id="LC23"><span class="nv">undcyn</span><span class="o">=</span><span class="s1">'\033[4;36m'</span> <span class="c"># Cyan</span></div><div class="line" id="LC24"><span class="nv">undwht</span><span class="o">=</span><span class="s1">'\033[4;37m'</span> <span class="c"># White</span></div><div class="line" id="LC25"><span class="nv">bakblk</span><span class="o">=</span><span class="s1">'\033[40m'</span>   <span class="c"># Black - Background</span></div><div class="line" id="LC26"><span class="nv">bakred</span><span class="o">=</span><span class="s1">'\033[41m'</span>   <span class="c"># Red</span></div><div class="line" id="LC27"><span class="nv">badgrn</span><span class="o">=</span><span class="s1">'\033[42m'</span>   <span class="c"># Green</span></div><div class="line" id="LC28"><span class="nv">bakylw</span><span class="o">=</span><span class="s1">'\033[43m'</span>   <span class="c"># Yellow</span></div><div class="line" id="LC29"><span class="nv">bakblu</span><span class="o">=</span><span class="s1">'\033[44m'</span>   <span class="c"># Blue</span></div><div class="line" id="LC30"><span class="nv">bakpur</span><span class="o">=</span><span class="s1">'\033[45m'</span>   <span class="c"># Purple</span></div><div class="line" id="LC31"><span class="nv">bakcyn</span><span class="o">=</span><span class="s1">'\033[46m'</span>   <span class="c"># Cyan</span></div><div class="line" id="LC32"><span class="nv">bakwht</span><span class="o">=</span><span class="s1">'\033[47m'</span>   <span class="c"># White</span></div><div class="line" id="LC33"><span class="nv">txtrst</span><span class="o">=</span><span class="s1">'\033[m'</span>   <span class="c"># Text Reset</span></div><div class="line" id="LC34"><br></div><div class="line" id="LC35">__vcs_status<span class="o">()</span> <span class="o">{</span></div><div class="line" id="LC36">&nbsp;&nbsp;<span class="k">if </span><span class="nb">type</span> -p __git_ps1; <span class="k">then</span></div><div class="line" id="LC37"><span class="k">    </span><span class="nv">branch</span><span class="o">=</span><span class="k">$(</span>__git_ps1<span class="k">)</span></div><div class="line" id="LC38">&nbsp;&nbsp;<span class="k">else</span></div><div class="line" id="LC39"><span class="k">    </span><span class="nv">branch</span><span class="o">=</span><span class="k">$(</span>git branch --no-color 2&gt; /dev/null | sed -e <span class="s1">'/^[^*]/d'</span> -e <span class="s1">'s/* \(.*\)/(\1)/'</span><span class="k">)</span></div><div class="line" id="LC40">&nbsp;&nbsp;<span class="k">fi</span></div><div class="line" id="LC41"><span class="k">  if</span> <span class="o">[</span> <span class="nv">$branch</span> <span class="o">]</span>; <span class="k">then</span></div><div class="line" id="LC42">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c"># not updated</span></div><div class="line" id="LC43">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">color</span><span class="o">=</span><span class="s2">"${txtpur}"</span></div><div class="line" id="LC44">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">status</span><span class="o">=</span><span class="k">$(</span>git status --porcelain 2&gt; /dev/null<span class="k">)</span></div><div class="line" id="LC45">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c"># if we have non untracked files (blue)</span></div><div class="line" id="LC46">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">"$status"</span> | grep <span class="s1">'?? '</span> &amp;&gt; /dev/null<span class="k">)</span>; <span class="k">then</span></div><div class="line" id="LC47"><span class="k">      </span><span class="nv">color</span><span class="o">=</span><span class="s2">"${txtblu}"</span></div><div class="line" id="LC48">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span></div><div class="line" id="LC49">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c">#  added to index (green)</span></div><div class="line" id="LC50">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">"$status"</span> | grep <span class="s1">'^A  '</span> &amp;&gt; /dev/null<span class="k">)</span>; <span class="k">then</span></div><div class="line" id="LC51"><span class="k">      </span><span class="nv">color</span><span class="o">=</span><span class="s2">"${txtgrn}"</span></div><div class="line" id="LC52">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span></div><div class="line" id="LC53">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c"># updated in index (Cyan)</span></div><div class="line" id="LC54">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">"$status"</span> | grep <span class="s1">'^ M '</span> &amp;&gt; /dev/null<span class="k">)</span>; <span class="k">then</span></div><div class="line" id="LC55"><span class="k">      </span><span class="nv">color</span><span class="o">=</span><span class="s2">"${txtcyn}"</span></div><div class="line" id="LC56">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span></div><div class="line" id="LC57">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c">#  deleted from index (red)</span></div><div class="line" id="LC58">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">"$status"</span> | grep <span class="s1">'^ D '</span> &amp;&gt; /dev/null<span class="k">)</span>; <span class="k">then</span></div><div class="line" id="LC59"><span class="k">      </span><span class="nv">color</span><span class="o">=</span><span class="s2">"${txtred}"</span></div><div class="line" id="LC60">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span></div><div class="line" id="LC61"><span class="k">    </span><span class="nb">echo</span> -e <span class="nv">$color</span></div><div class="line" id="LC62">&nbsp;&nbsp;<span class="k">fi</span></div><div class="line" id="LC63"><span class="o">}</span></div><div class="line" id="LC64"><br></div></pre>
</script>

I am not that good at bash and I would be more then happy to hear your
your suggestions how to make implementation smaller or faster. Any other
suggestions or comments are also very welcome.

Finally if you want to see full implementation check out my
[git repo][repo].

[repo]:http://github.com/Gozala/.bash "git repo with my bash config"

